<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>作业收集管理平台 | 上传作业</title>
  <link rel="shortcut icon" href="/static/img/logo.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/css/upload1.css" />
  <link rel="stylesheet" href="/static/css/upload.css" />

  <!-- 🔥 内嵌美化样式 -->
  <style>
    /* 背景动态粒子 + 渐变色 */
    body {
      margin: 0;
      font-family: 'Segoe UI', 'PingFang SC', sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #fce4ec);
      overflow-x: hidden;
      position: relative;
      color: #333;
    }

    /* 粒子背景容器 */
    #particles {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -1;
      top: 0;
      left: 0;
    }

    h1.text-center {
      color: #2c3e50;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }

    .alert {
      border-radius: 12px;
      max-width: 600px;
      margin: 20px auto;
      font-weight: 500;
      padding: 12px 20px;
      opacity: 1;
    }

    .alert-success { background: #e0f9ec; color: #2ecc71; }
    .alert-warning { background: #fff8e1; color: #f39c12; }
    .alert-primary { background: #e3f2fd; color: #3498db; }

    /* 卡片拟态样式 */
    .card {
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      animation: floatUp 0.8s ease forwards;
    }

    @keyframes floatUp {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .input-group-text {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 12px 0 0 12px;
    }

    .form-control {
      border: 1px solid #ccc;
      border-left: none;
      border-radius: 0 12px 12px 0;
      padding: 10px 14px;
    }

    .form-control:focus {
      border-color: #3498db;
      box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
    }

    .btn {
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: #fff;
      padding: 12px 28px;
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(52,152,219,0.4);
    }

    .btn-primary:hover {
      transform: scale(1.04);
      box-shadow: 0 6px 18px rgba(52,152,219,0.55);
    }

    .btn-primary:active {
      transform: scale(0.97);
    }

    .btn-secondary {
      background-color: #95a5a6;
      color: #fff;
      border-radius: 10px;
    }

    .btn-danger {
      border-radius: 8px;
      font-size: 0.85rem;
    }

    /* 加载动画 */
    .btn-loading {
      pointer-events: none;
      opacity: 0.7;
      position: relative;
    }

    .btn-loading::after {
      content: "";
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      border: 2px solid white;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>

<body>
  <!-- 背景粒子效果 -->
  <canvas id="particles"></canvas>

  <!-- 提示消息 -->
  <div class="container">
    {% for message in messages %}
      {% if message.tags == 'success' %}
        <div class="alert alert-success text-center" role="alert">{{ message }}</div>
      {% elif message.tags == 'warning' %}
        <div class="alert alert-warning text-center" role="alert">{{ message }}</div>
      {% else %}
        <div class="alert alert-primary text-center" role="alert">{{ message }}</div>
      {% endif %}
    {% endfor %}
  </div>

  <div class="container my-5">
    <h1 class="text-center">{{ task_name }}</h1>
    <div class="row justify-content-center mt-5">
      <div class="col-md-6">
        <div class="card shadow-sm p-4">
          <div class="card-body">
            <form method="POST" action="" enctype="multipart/form-data" id="upload-form">
              {% csrf_token %}
              <div class="mb-3">
                <label for="filename" class="form-label">请输入学号-姓名：</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                  <input type="text" name="file_name" id="filename" class="form-control" placeholder="例如：29-卢涛" required />
                </div>
              </div>
              <div class="mb-3" id="file-inputs">
                <label for="upfile1" class="form-label">请选择文件</label>
                <div class="input-group mb-3">
                  <input type="file" name="file1" id="upfile1" class="form-control" required />
                  <label for="upfile1" class="input-group-text"><i class="bi bi-cloud-arrow-up-fill"></i></label>
                  <button type="button" class="btn btn-danger btn-sm remove-file-input">删除</button>
                </div>
              </div>
              <button type="button" id="add-file-input" class="btn btn-secondary mb-3">添加更多文件</button>
              <div class="text-center">
                <button type="submit" id="submit-btn" class="btn btn-primary btn-lg">上传</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JS 脚本 -->
  <script src="/static/js/upload.js"></script>
  <script src="/static/js/moreupload.js"></script>
  <script>
    // 上传按钮 loading 效果
    const form = document.getElementById('upload-form');
    const submitBtn = document.getElementById('submit-btn');

    form.addEventListener('submit', () => {
      submitBtn.classList.add('btn-loading');
      submitBtn.innerText = '上传中...';
    });

    // 自动隐藏 alert 提示信息
    window.addEventListener('DOMContentLoaded', () => {
      const alerts = document.querySelectorAll('.alert');
      alerts.forEach(alert => {
        setTimeout(() => {
          alert.style.transition = 'opacity 0.8s ease';
          alert.style.opacity = '0';
          setTimeout(() => alert.remove(), 800);
        }, 4000);
      });
    });

    // 粒子背景动画
    const canvas = document.getElementById('particles');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const particles = [];
    for (let i = 0; i < 100; i++) {
      particles.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 2 + 1,
        dx: (Math.random() - 0.5) * 0.5,
        dy: (Math.random() - 0.5) * 0.5,
      });
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach(p => {
        p.x += p.dx;
        p.y += p.dy;

        if (p.x < 0 || p.x > canvas.width) p.dx *= -1;
        if (p.y < 0 || p.y > canvas.height) p.dy *= -1;

        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(52,152,219,0.3)';
        ctx.fill();
      });
      requestAnimationFrame(animate);
    }
    animate();
  </script>
</body>
</html>
